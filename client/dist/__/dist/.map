{"version":3,"sources":["node_modules/@rclarey/simple-ot/dist/control.js","node_modules/@rclarey/simple-ot/dist/charwise.js","node_modules/@rclarey/simple-ot/dist/mod.js","modal.ts","error.ts","editor.ts","util.ts","main.ts"],"names":["OT","constructor","inclusionTransform","exclusionTransform","siteID","historyBuffer","idHistory","operationsAreIndependent","op1","op2","id","addToHistory","op","push","history","transpose","op2Prime","listTranspose","start","end","hb","i","result","listInclusionTransform","operation","transformed","length","goto","k","pre","r","OperationType","Operation","type","position","isNoop","auxPos","Insert","char","INSERT","Delete","DELETE","pos","Math","min","op3","op4","serialize","serialized","deserialize","charwise"],"mappings":"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","file":".js","sourceRoot":"..","sourcesContent":["export class OT {\n    constructor(inclusionTransform, exclusionTransform, siteID) {\n        this.inclusionTransform = inclusionTransform;\n        this.exclusionTransform = exclusionTransform;\n        this.siteID = siteID;\n        this.historyBuffer = [];\n        this.idHistory = [];\n    }\n    static operationsAreIndependent(op1, op2) {\n        for (const id of op1.historyBuffer) {\n            if (id === op2.id) {\n                return false;\n            }\n        }\n        return true;\n    }\n    addToHistory(op) {\n        this.historyBuffer.push(op);\n        this.idHistory.push(op.id);\n    }\n    history() {\n        return this.idHistory;\n    }\n    transpose(op1, op2) {\n        const op2Prime = this.exclusionTransform(op2, op1);\n        const op1Prime = this.inclusionTransform(op1, op2Prime);\n        return [op2Prime, op1Prime];\n    }\n    listTranspose(start, end) {\n        const hb = this.historyBuffer;\n        for (let i = end; i > start; i -= 1) {\n            const result = this.transpose(hb[i - 1], hb[i]);\n            [hb[i - 1], hb[i]] = result;\n        }\n    }\n    listInclusionTransform(operation, start) {\n        let transformed = operation;\n        for (let i = start; i < this.historyBuffer.length; i += 1) {\n            const op2 = this.historyBuffer[i];\n            transformed = this.inclusionTransform(transformed, op2);\n        }\n        return transformed;\n    }\n    goto(operation) {\n        let k = -1;\n        for (let i = 0; i < this.historyBuffer.length; i += 1) {\n            if (OT.operationsAreIndependent(operation, this.historyBuffer[i])) {\n                k = i;\n                break;\n            }\n        }\n        if (k === -1) {\n            return operation;\n        }\n        const pre = [];\n        for (let i = k + 1; i < this.historyBuffer.length; i += 1) {\n            if (!OT.operationsAreIndependent(operation, this.historyBuffer[i])) {\n                pre.push(i);\n            }\n        }\n        if (pre.length === 0) {\n            return this.listInclusionTransform(operation, k);\n        }\n        const r = pre.length;\n        for (let i = 0; i < r; i += 1) {\n            this.listTranspose(k + i, pre[i]);\n        }\n        return this.listInclusionTransform(operation, k + r);\n    }\n}\n","export var OperationType;\n(function (OperationType) {\n    OperationType[\"DELETE\"] = \"d\";\n    OperationType[\"INSERT\"] = \"i\";\n})(OperationType || (OperationType = {}));\nexport class Operation {\n    constructor(type, position, id, siteID, historyBuffer, isNoop) {\n        this.type = type;\n        this.position = position;\n        this.id = id;\n        this.siteID = siteID;\n        this.historyBuffer = historyBuffer;\n        this.isNoop = isNoop;\n        this.auxPos = position;\n    }\n}\nexport class Insert extends Operation {\n    constructor(char, position, id, siteID, historyBuffer, isNoop = false) {\n        super(OperationType.INSERT, position, id, siteID, historyBuffer, isNoop);\n        this.char = char;\n    }\n}\nexport class Delete extends Operation {\n    constructor(position, id, siteID, historyBuffer, isNoop = false) {\n        super(OperationType.DELETE, position, id, siteID, historyBuffer, isNoop);\n    }\n}\nexport function inclusionTransform(op1, op2) {\n    if (op1.isNoop) {\n        if (op1 instanceof Delete && op2 instanceof Insert && op1.position === op2.position) {\n            return new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        return op1;\n    }\n    if (op2.isNoop) {\n        if (op1 instanceof Insert && op2 instanceof Delete && op1.position === op2.auxPos) {\n            return new Insert(op1.char, op1.position, op1.id, op1.siteID, op1.historyBuffer, true);\n        }\n        return op1;\n    }\n    if (op1 instanceof Insert && op2 instanceof Insert) {\n        if (op1.position < op2.position ||\n            (op1.position === op2.position && op1.siteID <= op2.siteID)) {\n            return new Insert(op1.char, op1.auxPos, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        const pos = Math.min(op1.position, op1.auxPos) + 1;\n        return new Insert(op1.char, pos, op1.id, op1.siteID, op1.historyBuffer);\n    }\n    if (op1 instanceof Insert && op2 instanceof Delete) {\n        if (op1.position <= op2.position) {\n            return op1;\n        }\n        const op3 = new Insert(op1.char, op1.position - 1, op1.id, op1.siteID, op1.historyBuffer);\n        op3.auxPos = op1.position;\n        return op3;\n    }\n    if (op1 instanceof Delete && op2 instanceof Insert) {\n        if (op1.position < op2.position) {\n            return op1;\n        }\n        return new Delete(op1.position + 1, op1.id, op1.siteID, op1.historyBuffer);\n    }\n    if (op1 instanceof Delete && op2 instanceof Delete) {\n        if (op1.position === op2.position) {\n            return new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer, true);\n        }\n        if (op1.position < op2.position) {\n            return op1;\n        }\n        const op3 = new Delete(op1.position - 1, op1.id, op1.siteID, op1.historyBuffer);\n        op3.auxPos = op1.position;\n        return op3;\n    }\n    return op1;\n}\nexport function exclusionTransform(op1, op2) {\n    if (op1.isNoop) {\n        if (op2.isNoop &&\n            op1.position === op2.position &&\n            op1 instanceof Insert &&\n            op2 instanceof Delete) {\n            return new Insert(op1.char, op1.position, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        if (op1.position === op2.position && op1 instanceof Delete && op2 instanceof Delete) {\n            return new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        if (op1 instanceof Delete && op2 instanceof Insert) {\n            const op = new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer, true);\n            op.auxPos = -1;\n            return op;\n        }\n        return op1;\n    }\n    if (op2.isNoop) {\n        return op1;\n    }\n    if (op1 instanceof Insert && op2 instanceof Insert) {\n        if (op1.position === op2.position && op1.siteID > op2.siteID) {\n            const op3 = new Insert(op1.char, op1.position, op1.id, op1.siteID, op1.historyBuffer);\n            op3.auxPos = op1.position - 1;\n            return op3;\n        }\n        if (op1.position <= op2.position) {\n            op2.auxPos = op2.position + 1;\n            return op1;\n        }\n        const op4 = new Insert(op1.char, op1.position - 1, op1.id, op1.siteID, op1.historyBuffer);\n        if (op1.siteID < op2.siteID) {\n            op4.auxPos = op1.position;\n        }\n        return op4;\n    }\n    if (op1 instanceof Insert && op2 instanceof Delete) {\n        if (op1.position === op2.position) {\n            return new Insert(op1.char, op1.auxPos, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        if (op1.position < op2.position) {\n            return op1;\n        }\n        return new Insert(op1.char, op1.position + 1, op1.id, op1.siteID, op1.historyBuffer);\n    }\n    if (op1 instanceof Delete && op2 instanceof Insert) {\n        if (op1.position === op2.position) {\n            return new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer, true);\n        }\n        if (op1.position < op2.position) {\n            return op1;\n        }\n        return new Delete(op1.position - 1, op1.id, op1.siteID, op1.historyBuffer);\n    }\n    if (op1 instanceof Delete && op2 instanceof Delete) {\n        if (op1.position >= op2.position) {\n            return new Delete(op1.position + 1, op1.id, op1.siteID, op1.historyBuffer);\n        }\n        return new Delete(op1.position, op1.id, op1.siteID, op1.historyBuffer);\n    }\n    return op1;\n}\nexport function serialize(operation) {\n    const { historyBuffer, id, type, position, siteID } = operation;\n    const serialized = { historyBuffer, id, type, position, siteID };\n    if (operation instanceof Insert) {\n        serialized.char = operation.char;\n    }\n    return serialized;\n}\nexport function deserialize(op) {\n    if (op.type === OperationType.INSERT) {\n        return new Insert(op.char, op.position, op.id, op.siteID, op.historyBuffer);\n    }\n    return new Delete(op.position, op.id, op.siteID, op.historyBuffer);\n}\n","export { OT } from './control';\nimport { Delete, Insert, Operation, OperationType, deserialize, exclusionTransform, inclusionTransform, serialize, } from './charwise';\nexport const charwise = {\n    Delete,\n    Insert,\n    Operation,\n    OperationType,\n    deserialize,\n    exclusionTransform,\n    inclusionTransform,\n    serialize,\n};\n","interface ModalOptions {\n  title: string;\n  body: string[];\n  confirm?: string;\n  onConfirm?: () => Promise<unknown>;\n}\n\nexport default function modal(opts: ModalOptions): HTMLDivElement {\n  const bg = document.createElement(\"div\");\n  bg.className = \"modal__bg\";\n\n  const root = document.createElement(\"div\");\n  root.className = \"modal__root\";\n  bg.appendChild(root);\n\n  const head = document.createElement(\"h1\");\n  head.className = \"modal__head\";\n  head.innerHTML = opts.title;\n  root.appendChild(head);\n\n  for (const text of opts.body) {\n    const p = document.createElement(\"p\");\n    p.className = \"modal__p\";\n    p.innerHTML = text;\n    root.appendChild(p);\n  }\n\n  if (opts.confirm) {\n    const button = document.createElement(\"button\");\n    button.className = \"modal__confirm\";\n    button.innerHTML = opts.confirm;\n    button.addEventListener(\"click\", async () => {\n      await opts.onConfirm!();\n      document.body.removeChild(root);\n      document.body.removeChild(bg);\n    });\n    root.appendChild(button);\n  }\n\n  document.body.appendChild(bg);\n\n  return bg;\n}\n","import modal from \"./modal\";\n\nexport function fatalError(): void {\n  for (const elem of document.body.children) {\n    document.body.removeChild(elem);\n  }\n\n  modal({\n    title: \"Error!\",\n    body: [\n      \"Something unexpected went wrong!\",\n      \"You can try refreshing the page to fix it.\"\n    ]\n  });\n}\n\nexport async function networkError(p: Promise<void>): Promise<void> {\n  const m = modal({\n    title: \"Lost connection!\",\n    body: [\"Attempting to reconnect...\"]\n  });\n  await p;\n  document.body.removeChild(m);\n}\n","///<reference path=\"../types/codemirror.d.ts\" />\nimport { OT, charwise } from \"@rclarey/simple-ot\";\nimport { fatalError } from \"./error\";\n\nconst wsUrl = \"ws://localhost:8080\";\nconst supportedModes: [string, string][] = [\n  [\"APL\", \"apl\"],\n  [\"ASN.1\", \"asn.1\"],\n  [\"Asterisk dialplan\", \"asterisk\"],\n  [\"Brainfuck\", \"brainfuck\"],\n  [\"C, C++, C#\", \"clike\"],\n  [\"Ceylon\", \"clike\"],\n  [\"Clojure\", \"clojure\"],\n  [\"Closure Stylesheets (GSS)\", \"css/gss.html\"],\n  [\"CMake\", \"cmake\"],\n  [\"COBOL\", \"cobol\"],\n  [\"CoffeeScript\", \"coffeescript\"],\n  [\"Common Lisp\", \"commonlisp\"],\n  [\"Crystal\", \"crystal\"],\n  [\"CSS\", \"css\"],\n  [\"Cypher\", \"cypher\"],\n  [\"Cython\", \"python\"],\n  [\"D\", \"d\"],\n  [\"Dart\", \"dart\"],\n  [\"Django (templating language)\", \"django\"],\n  [\"Dockerfile\", \"dockerfile\"],\n  [\"diff\", \"diff\"],\n  [\"DTD\", \"dtd\"],\n  [\"Dylan\", \"dylan\"],\n  [\"EBNF\", \"ebnf\"],\n  [\"ECL\", \"ecl\"],\n  [\"Eiffel\", \"eiffel\"],\n  [\"Elm\", \"elm\"],\n  [\"Erlang\", \"erlang\"],\n  [\"Factor\", \"factor\"],\n  [\"FCL\", \"fcl\"],\n  [\"Forth\", \"forth\"],\n  [\"Fortran\", \"fortran\"],\n  [\"F#\", \"mllike\"],\n  [\"Gas (AT&T-style assembly)\", \"gas\"],\n  [\"Gherkin\", \"gherkin\"],\n  [\"Go\", \"go\"],\n  [\"Groovy\", \"groovy\"],\n  [\"HAML\", \"haml\"],\n  [\"Handlebars\", \"handlebars\"],\n  [\"Haskell\", \"haskell\"],\n  [\"Haskell (Literate)\", \"haskell-literate\"],\n  [\"Haxe\", \"haxe\"],\n  [\"HTML embedded\", \"htmlembedded\"],\n  [\"HTML mixed-mode\", \"htmlmixed\"],\n  [\"HTTP\", \"http\"],\n  [\"IDL\", \"idl\"],\n  [\"Java\", \"clike\"],\n  [\"JavaScript\", \"javascript\"],\n  [\"JSX\", \"jsx\"],\n  [\"Jinja2\", \"jinja2\"],\n  [\"Julia\", \"julia\"],\n  [\"Kotlin\", \"clike\"],\n  [\"LESS\", \"css\"],\n  [\"LiveScript\", \"livescript\"],\n  [\"Lua\", \"lua\"],\n  [\"Markdown\", \"markdown\"],\n  [\"Markdown (GitHub-flavour)\", \"gfm\"],\n  [\"Mathematica\", \"mathematica\"],\n  [\"mbox\", \"mbox\"],\n  [\"mIRC\", \"mirc\"],\n  [\"Modelica\", \"modelica\"],\n  [\"MscGen\", \"mscgen\"],\n  [\"MUMPS\", \"mumps\"],\n  [\"Nginx\", \"nginx\"],\n  [\"NSIS\", \"nsis\"],\n  [\"N-Triples/N-Quads\", \"ntriples\"],\n  [\"Objective C\", \"clike\"],\n  [\"OCaml\", \"mllike\"],\n  [\"Octave\", \"octave\"],\n  [\"Oz\", \"oz\"],\n  [\"Pascal\", \"pascal\"],\n  [\"PEG.js\", \"pegjs\"],\n  [\"Perl\", \"perl\"],\n  [\"PGP (ASCII armor)\", \"asciiarmor\"],\n  [\"PHP\", \"php\"],\n  [\"Pig Latin\", \"pig\"],\n  [\"PowerShell\", \"powershell\"],\n  [\"Properties files\", \"properties\"],\n  [\"ProtoBuf\", \"protobuf\"],\n  [\"Pug\", \"pug\"],\n  [\"Puppet\", \"puppet\"],\n  [\"Python\", \"python\"],\n  [\"Q\", \"q\"],\n  [\"R\", \"r\"],\n  [\"RPM\", \"rpm\"],\n  [\"reStructuredText\", \"rst\"],\n  [\"Ruby\", \"ruby\"],\n  [\"Rust\", \"rust\"],\n  [\"SAS\", \"sas\"],\n  [\"Sass\", \"sass\"],\n  [\"Spreadsheet\", \"spreadsheet\"],\n  [\"Scala\", \"clike\"],\n  [\"Scheme\", \"scheme\"],\n  [\"SCSS\", \"css\"],\n  [\"Shell\", \"shell\"],\n  [\"Sieve\", \"sieve\"],\n  [\"Slim\", \"slim\"],\n  [\"Smalltalk\", \"smalltalk\"],\n  [\"Smarty\", \"smarty\"],\n  [\"Solr\", \"solr\"],\n  [\"Soy\", \"soy\"],\n  [\"Stylus\", \"stylus\"],\n  [\"SQL\", \"sql\"],\n  [\"SPARQL\", \"sparql\"],\n  [\"Squirrel\", \"clike\"],\n  [\"Swift\", \"swift\"],\n  [\"sTeX, LaTeX\", \"stex\"],\n  [\"Tcl\", \"tcl\"],\n  [\"Textile\", \"textile\"],\n  [\"Tiddlywiki\", \"tiddlywiki\"],\n  [\"Tiki wiki\", \"tiki\"],\n  [\"TOML\", \"toml\"],\n  [\"Tornado\", \"tornado\"],\n  [\"troff\", \"troff\"],\n  [\"TTCN\", \"ttcn\"],\n  [\"TTCN Configuration\", \"ttcn-cfg\"],\n  [\"Turtle\", \"turtle\"],\n  [\"Twig\", \"twig\"],\n  [\"VB.NET\", \"vb\"],\n  [\"VBScript\", \"vbscript\"],\n  [\"Velocity\", \"velocity\"],\n  [\"Verilog/SystemVerilog\", \"verilog\"],\n  [\"VHDL\", \"vhdl\"],\n  [\"Vue.js app\", \"vue\"],\n  [\"Web IDL\", \"webidl\"],\n  [\"XML/HTML\", \"xml\"],\n  [\"XQuery\", \"xquery\"],\n  [\"Yacas\", \"yacas\"],\n  [\"YAML\", \"yaml\"],\n  [\"YAML frontmatter\", \"yaml-frontmatter\"],\n  [\"Z80\", \"z80\"]\n];\n\nfunction ensureMode(name: string): void {\n  const modeUrl = `https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.53.2/mode/${name}/${name}.min.js`;\n  if (!document.querySelector(`script[src=\"${modeUrl}\"]`)) {\n    const s = document.createElement(\"script\");\n    s.src = modeUrl;\n    document.body.appendChild(s);\n  }\n}\n\nfunction modePicker(init: string): (m: string) => void {\n  const select = 0;\n}\n\nfunction setupCodeMirror(\n  root: HTMLDivElement,\n  socket: WebSocket,\n  siteId: number,\n  value: string,\n  mode: string\n): CodeMirror.Editor {\n  const cm = CodeMirror(root, {\n    value,\n    mode,\n    theme: \"nord\"\n  });\n  cm.on(\"change\", (instance, change) => {\n    console.log(instance, change);\n    socket.send(\"a\");\n  });\n  const ot = new OT(\n    charwise.inclusionTransform,\n    charwise.exclusionTransform,\n    siteId\n  );\n  ot.history();\n\n  return cm;\n}\n\nexport default async function editor(id: string): Promise<void> {\n  const topbar = document.createElement(\"div\");\n  topbar.className = \"topbar\";\n  const root = document.createElement(\"div\");\n  root.className = \"editor__root\";\n\n  const socket = new WebSocket(wsUrl);\n  socket.onopen = () => socket.send(JSON.stringify({ type: \"init\", id }));\n  socket.onmessage = e => {\n    try {\n      const msg = JSON.parse(e.data);\n      if (msg.type !== \"ack\") {\n        socket.close();\n        fatalError();\n      } else {\n        ensureMode(msg.mode);\n        setupCodeMirror(root, socket, msg.siteId, msg.value, msg.mode);\n      }\n    } catch {\n      socket.close();\n      fatalError();\n    }\n  };\n}\n","const alphabet =\n  \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz\";\n\nexport function genId(): string {\n  let id = \"\";\n  let i = 12;\n  while (i--) {\n    id += alphabet[(Math.random() * 64) | 0];\n  }\n  return id;\n}\n","import editor from \"./editor\";\nimport modal from \"./modal\";\nimport { genId } from \"./util\";\n\nfunction docId(): string | null {\n  const re = /\\?doc=(?<id>[^&]*)/;\n  return re.exec(location.search)?.groups?.id ?? null;\n}\n\nfunction render(): void {\n  const id = docId();\n  if (!id) {\n    modal({\n      title: \"Welcome!\",\n      body: [\n        'Cloudcode was mostly built as a functional example for my <a href=\"https://github.com/rclarey/simple-ot\">operational transform library</a>, however it <i>is</i> useful for quickly creating a shareable document that can be collaboratively edited, for a video call with your team for example.',\n        \"<b>WARNING:</b> documents are only stored in memory on the server, so there is no guarantee that they will be persisted once all clients disconnect. Do not rely on Cloudcode to persist your documents.\"\n      ],\n      confirm: \"Create a new document\",\n      onConfirm: async () => {\n        const newId = genId();\n        location.search = `doc=${newId}`;\n        editor(newId);\n      }\n    });\n  } else {\n    editor(id);\n  }\n}\n\nrender();\n"]}